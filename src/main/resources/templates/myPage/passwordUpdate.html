<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<title>Insert title here</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
	crossorigin="anonymous">
	<style>
.logoImg {
	width: 40px;
	height: 40px;
}
</style>
<link rel="stylesheet" href="/css/passwordUpdate.css">
</head>
<body>
<div th:replace="layout/header :: headFrag"></div>
	<div>
		<form action="" method="post"  th:object="${member}" name="updatePassword" class="pwUpdateForm">
			<h3>비밀번호 변경</h3>
			<p>다른 아이디/사이트에서 사용한 적 없는 비밀번호<br/>이전에 사용한 적 없는 비밀번호가 안전합니다.</p>			
			<br>								
			<input type="password" id="oldpassword" maxlength="25" placeholder="현재 비밀번호" name="oldpassword"><br>
			<input type="password" id="newInputPwd" maxlength="25" placeholder ="새 비밀번호" th:field="*{password}" name="password"><br>
			<input type="password" id="reInputPwd" maxlength="25" placeholder ="새 비밀번호 확인"><br>
			<button type="submit" id="pwdCheckBtn">확인</button>
			<button type="button" th:onClick="|location.href='@{/}'|" class="pwUpdateBackBtn">뒤로가기</button>
		</form>
	</div>
	<script>
	var pwdCheck = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/; //비밀번호 영문자+숫자+특수조합(8~25자리 입력) 정규식
	
	var password = document.getElementById("oldpassword");
	var newInputPwd = document.getElementById("newInputPwd");
	var mail = document.getElementById("mail");
	var reInputPwd = document.getElementById("reInputPwd");
	
	document.getElementById('pwdCheckBtn').addEventListener('click', (e)=>{ 
		e.preventDefault();
		let form = document.updatePassword;

		  if (!pwdCheck.test(newInputPwd.value)) {
		    alert("비밀번호는 영문자+숫자+특수문자 조합으로 8~25자리 사용해야 합니다.");
		    newInputPwd.focus();
		    return false;
		  };
		  if(newInputPwd.value != reInputPwd.value){
			  alert("비밀번호를 확인해주세요.");
			  newInputPwd.focus();
			  return false;
		  }
		  if(password.value == newInputPwd.value){
			  alert("새 비밀번호는 현재 비밀번호와 다르게 설정해주세요.");
			  newInputPwd.focus();
			  return false;
		  }
		  
		  $.ajax({
			  type: "POST",
			  url: "/myPage/pwcheck",
			  data: {password : $('input#oldpassword').val()},
			  success: function(data) {
				  if(data.result == 1) {
					  if(confirm('비밀번호를 변경 하시겠습니까?')){
							alert('변경에 성공하였습니다.'); 
							 form.submit();
							}
				  } else {
					  alert("현재 비밀번호를 확인해주세요.");
					  password.focus();
					  return false;
				  }
			  }
		  })
	});
	</script>
		<!-- JavaScript Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
		crossorigin="anonymous"></script>
</body>
</html>