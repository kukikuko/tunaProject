<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<title>Insert title here</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css"> <!-- alert μ°½     -->
<link rel="stylesheet" href="/css/header.css" />

</head>
<body>
	<div th:replace="layout/header :: headFrag"></div>
	<form action="" method="post" th:object="${member}"
		name="deleteMemeber" class="mamebrOutForm">
		<div class="pwdCheckBox" id="pwdCheckBox">
			<h3>νμ›νƒν‡΄</h3>
			<p>ν„μ¬ λΉ„λ°€λ²νΈλ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”.</p>
			<br> <label> <input type="password" id="oldpassword"
				maxlength="25" placeholder="ν„μ¬ λΉ„λ°€λ²νΈ" name="oldpassword"><br>
			</label> <br />
			<button type="button" th:onClick="|location.href='@{/}'|"
				class="outBack">λ’¤λ΅κ°€κΈ°</button>
			<button type="button" id="checkBtn" class="outCheckBtn">ν™•μΈ</button>
			<br />
		</div>
		<div class="memberOutBox" id="memberOutBox">
			<p th:text="${member?.memberName}+'λ‹μ νμ› νƒν‡΄λ¥Ό μ§„ν–‰ν•©λ‹λ‹¤.'"></p>
			<button type="submit" id="deleteBtn" class="outBtn">νƒν‡΄</button>
		</div>
		<br>
	</form>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
	<script>
	$("#memberOutBox").css("display", "none");
	var pwdCheck = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/; //λΉ„λ°€λ²νΈ μλ¬Έμ+μ«μ+νΉμμ΅°ν•©(8~25μλ¦¬ μ…λ ¥) μ •κ·μ‹
	var password = document.getElementById("oldpassword");
	var checkCnt = 0;

	document.getElementById('checkBtn').addEventListener('click', (e)=>{ 
		e.preventDefault();
		let form = document.deleteMemeber;

		  $.ajax({
			  type: "POST",
			  url: "/myPage/pwcheck",
			  data: {password : $('input#oldpassword').val()},
			  success: function(data) {
				  if(data.result == 1) {
					  
					  Swal.fire({
				            title: "λΉ„λ°€λ²νΈκ°€ μΌμΉν•©λ‹λ‹¤!", // Alert μ λ©
				            text: "νμ› νƒν‡΄ λ²„νΌμ„ ν΄λ¦­ν•λ©΄, νƒν‡΄κ°€ μ§„ν–‰λμ”.", // Alert λ‚΄μ©
				            icon: "success", // Alert νƒ€μ…
				          }); 
						checkCnt=1;
						 $("#memberOutBox").show();
						 $("#pwdCheckBox").css("display", "none");
				  } else {
					  Swal.fire({
				            title: "λΉ„λ°€λ²νΈλ¥Ό ν™•μΈν•΄μ£Όμ„Έμ”.", // Alert μ λ©
				            text: "μ…λ ¥ν• λΉ„λ°€λ²νΈκ°€ μΌμΉν•μ§€ μ•μµλ‹λ‹¤.", // Alert λ‚΄μ©
				            icon: "warning", // Alert νƒ€μ…
				          });
					  password.focus();
					  return false;
				  }
			  }
		  })
	});
	
	document.getElementById('deleteBtn').addEventListener('click', (e)=>{ 
		e.preventDefault();
		let form = document.deleteMemeber;
		
		if(checkCnt == 1){
			Swal.fire({
	            title: "νμ›νƒν‡΄λ¥Ό μ§„ν–‰ν•μ‹κ² μµλ‹κΉ?",
	            text: "",
	            icon: "warning",
	            showCancelButton: true,
	            confirmButtonColor: "#3085d6",
	            cancelButtonColor: "#d33",
	            confirmButtonText: "μΉμΈ",
	            cancelButtonText: "μ·¨μ†",
	            reverseButtons: true,
	          }).then((result) => {
	        	  if(result.isConfirmed) {
			            Swal.fire({
			            	title: "νμ› νƒν‡΄κ°€ μ§„ν–‰λμ—μµλ‹λ‹¤.", // Alert μ λ©
			                text: "λ‹¤μμ— λ‹¤μ‹ λ§λ‚μ”π‚", // Alert λ‚΄μ©
			                icon: "success", // Alert νƒ€μ…
			            }).then((result) => {
			              	form.submit();	
			            });
	        	  }
	          });
		}else{
			Swal.fire({
	            title: "ν„μ¬ λΉ„λ°€λ²νΈλ¥Ό ν™•μΈν•΄μ£Όμ„Έμ”.", // Alert μ λ©
	            text: "λΉ„λ°€λ²νΈ μΈμ¦μ„ λ§μ³μ•Ό, νμ›νƒν‡΄λ¥Ό μ§„ν–‰ν•  μ μμ–΄μ”.", // Alert λ‚΄μ©
	            icon: "warning", // Alert νƒ€μ…
	          });
			return false;
		}
		
		});	
</script>
	<script src="https://kit.fontawesome.com/9f54d9c571.js"
		crossorigin="anonymous"></script>
</body>
</html>