<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<title>Insert title here</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
	crossorigin="anonymous">
<style>
.logoImg {
	width: 40px;
	height: 40px;
}
</style>
<link rel="stylesheet" href="/css/memberOut.css">
</head>
<body>
	<div th:replace="layout/header :: headFrag"></div>
	<form action="" method="post" th:object="${member}" name="deleteMemeber" class="mamebrOutForm">
		<div class="pwdCheckBox" id="pwdCheckBox">
			<h3>회원탈퇴</h3>
			<p>현재 비밀번호를 입력해주세요.</p>
			<br> 
			<label> 
				<input type="password" id="oldpassword" maxlength="25" placeholder="현재 비밀번호" name="oldpassword"><br>
			</label>
			<br/>
			<button type="button" id="checkBtn" class="outCheckBtn">확인</button>
		<button type="button" th:onClick="|location.href='@{/}'|" class="outBack">뒤로가기</button>
			<br/>
		</div>
		<div class="memberOutBox" id="memberOutBox">
			<p th:text="${member?.memberName}+'님의 회원 탈퇴를 진행합니다.'"></p>
			<button type="submit" id="deleteBtn" class="outBtn">탈퇴</button>
		</div>
		<br>
	</form>
	<script>
	$("#memberOutBox").css("display", "none");
	var pwdCheck = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/; //비밀번호 영문자+숫자+특수조합(8~25자리 입력) 정규식
	var password = document.getElementById("oldpassword");
	var checkCnt = 0;
	
	
	document.getElementById('checkBtn').addEventListener('click', (e)=>{ 
		e.preventDefault();
		let form = document.deleteMemeber;

		  $.ajax({
			  type: "POST",
			  url: "/myPage/pwcheck",
			  data: {password : $('input#oldpassword').val()},
			  success: function(data) {
				  if(data.result == 1) {
						alert('비밀번호가 일치합니다.'); 
						checkCnt++;
						 $("#memberOutBox").show();
						 $("#pwdCheckBox").css("display", "none");
				  } else {
					  alert("비밀번호가 일치하지 않습니다.");
					  password.focus();
					  return false;
				  }
			  }
		  })
	});
	
	document.getElementById('deleteBtn').addEventListener('click', (e)=>{ 
		e.preventDefault();
		let form = document.deleteMemeber;
		
		if(checkCnt == 1){
			if(confirm('회원 탈퇴하시겠습니까?')){
				alert('탈퇴 되었습니다.'); 
				 form.submit();
				}
		}else{
			alret('비밀번호 확인을 진행해주세요');
			return false;
		}
		
		});	
</script>
	<!-- JavaScript Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
		crossorigin="anonymous"></script>
</body>
</html>