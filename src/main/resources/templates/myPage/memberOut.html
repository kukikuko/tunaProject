<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<title>Insert title here</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css"> <!-- alert ì°½     -->
<link rel="stylesheet" href="/css/header.css" />
<link rel="stylesheet" href="/css/memberOut.css">
<link rel="stylesheet" href="/css/footerSmall.css" />
<style>
body, html{
 height: 100%;
} 
body {
  display: flex;
  flex-direction: column;
}
</style>
</head>
<body>
	<div th:replace="layout/header :: headFrag"></div>
	<form action="" method="post" th:object="${member}" name="deleteMemeber" class="mamebrOutForm" id="deleteMemeber">
		<div class="pwdCheckBox" id="pwdCheckBox">
			<h3>íšŒì›íƒˆí‡´</h3>
			<p>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
			<br> <label> 
			<input type="password" id="oldpassword" maxlength="25" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸" name="oldpassword"><br>
			</label><br />
			<button type="button" th:onClick="|location.href='@{/}'|" class="outBack">ë’¤ë¡œê°€ê¸°</button>
			<button type="button" id="checkBtn" class="outCheckBtn">í™•ì¸</button>
			<br />
		</div>
	</form>
	
	<form action="" method="post" th:object="${member}" name="memberOut" class="mamebrOutForm" id="memberOut">
		<div class="memberOutBox" id="memberOutBox">
			<p th:text="${member?.memberName}+'ë‹˜ì˜ íšŒì› íƒˆí‡´ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.'"></p>
			<button type="button" th:onClick="|location.href='@{/}'|" class="outBack">ë’¤ë¡œê°€ê¸°</button>
			<button type="button" id="deleteBtn" class="outBtn">íƒˆí‡´</button>
		</div>
	</form>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
	<script>
	$('input[type="password"]').keydown(function() {
		  if (event.keyCode === 13) {
		    event.preventDefault();
		  };
		});
	$("#memberOut").css("display", "none");
	var pwdCheck = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/; //ë¹„ë°€ë²ˆí˜¸ ì˜ë¬¸ì+ìˆ«ì+íŠ¹ìˆ˜ì¡°í•©(8~25ìë¦¬ ì…ë ¥) ì •ê·œì‹
	var password = document.getElementById("oldpassword");
	var checkCnt = 0;

	document.getElementById('checkBtn').addEventListener('click', (e)=>{ 
		e.preventDefault();
		let form = document.deleteMemeber;

		  $.ajax({
			  type: "POST",
			  url: "/myPage/pwcheck",
			  data: {password : $('input#oldpassword').val()},
			  success: function(data) {
				  if(data.result == 1) {
					  
					  Swal.fire({
				            title: "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤!", // Alert ì œëª©
				            text: "íšŒì› íƒˆí‡´ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´, íƒˆí‡´ê°€ ì§„í–‰ë˜ìš”.", // Alert ë‚´ìš©
				            icon: "success", // Alert íƒ€ì…
				          }); 
						checkCnt=1;
						 $("#memberOut").show();
						 $("#deleteMemeber").css("display", "none");
				  } else {
					  Swal.fire({
				            title: "ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.", // Alert ì œëª©
				            text: "", // Alert ë‚´ìš©
				            icon: "warning", // Alert íƒ€ì…
				          });
					  password.focus();
					  return false;
				  }
			  }
		  })
	});
	
	
	
	document.getElementById('deleteBtn').addEventListener('click', (e)=>{ 
		e.preventDefault();
		let form = document.memberOut;
		
		if(checkCnt == 1){
			Swal.fire({
	            title: "íšŒì›íƒˆí‡´ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
	            text: "",
	            icon: "warning",
	            showCancelButton: true,
	            confirmButtonColor: "#3085d6",
	            cancelButtonColor: "#d33",
	            confirmButtonText: "ìŠ¹ì¸",
	            cancelButtonText: "ì·¨ì†Œ",
	            reverseButtons: true,
	          }).then((result) => {
	        	  if(result.isConfirmed) {
			            Swal.fire({
			            	title: "íšŒì› íƒˆí‡´ê°€ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.", // Alert ì œëª©
			                text: "ë‹¤ìŒì— ë‹¤ì‹œ ë§Œë‚˜ìš”ğŸ˜‚", // Alert ë‚´ìš©
			                icon: "success", // Alert íƒ€ì…
			            }).then((result) => {
			              	form.submit();	
			            });
	        	  }
	          });
		}else{
			Swal.fire({
	            title: "í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.", // Alert ì œëª©
	            text: "", // Alert ë‚´ìš©
	            icon: "warning", // Alert íƒ€ì…
	          });
			return false;
		}
		
		});	
</script>
	<script src="https://kit.fontawesome.com/9f54d9c571.js"
		crossorigin="anonymous"></script>
</body>
<div class="footerSmall" id="footer">
  	<p>Copyright Â© SajoMarket 2023</p>
  	</div>
</html>