<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<title>Insert title here</title>
<!-- CSS only -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
	crossorigin="anonymous">
<link rel="stylesheet" href="/css/posts.css">
<style>
.logoImg {
	width: 40px;
	height: 40px;
}
</style>
</head>
<body>
	<div th:replace="layout/header :: headFrag"></div>
	<div class="Post" name="post" id="post" th:value="${post.postCode}">
		
		<p class="post-code" id="postCode" th:text="${post.postCode}">
		<p class="post-member" id="pMemCode" th:text="${post.pMemCode}">
		
		
		
		<p class="post-category" th:text="${post.ctName}">
		<p class="post-title" th:text=${post.pTitle}></p>
		<p class="post-price">가격 : <span th:text=${post.pPrice}></span></p>
		<p class="post-time" th:if="${post.pCorrectionTime == null}"
			th:text=${post.pCreateTime}></p>
		<p class="post-time" th:if="${post.pCorrectionTime != null}"
			th:text=${post.pCorrectionTime}></p>
		<p class="post-view">조회수 : <span th:text=${post.pView}></span></p>
		<p class="post-content" th:text=${post.pContent}></p>
		<img class="post-img" th:each="image : ${images}"
			th:src="|/posts/images/${image.imageFiles}|" width="300" height="300" /><br/>
		<button th:if="${post.pMemCode} == ${member.memberCode}"
			th:onClick="|location.href='@{/posts/update/{postCode}(postCode=${post.postCode})}'|"
			class="post_Btn">수정</button>
		<form action="/posts/delete" method="post" class="deleteForm">
			<input type="hidden" th:value="${post.postCode}" name="postCode">
			<button type="submit"
				th:if="${post.pMemCode} == ${member.memberCode}" class="post_Btn"
				th:onclick="return confirm('삭제하시겠습니까 ?');">삭제</button>
		</form>
		<button th:onclick="|location.href='@{/posts}'|" class="post_Btn_back">목록보기</button>
			
			<button th:if="${post.pMemCode} == ${member.memberCode}" style="display:none" 
			type="button" id="notifyBtn">신고하기</button>
			
			<button th:if="${post.pMemCode} != ${member.memberCode}"  
			type="button" id="notifyBtn">신고하기</button>
			
			
<!-- 			class 건들면 찜하기 작동 안함 ㅅㄱ -->
			<th:block th:if="${cnt123 == 0}">
				<button th:if="${post.pMemCode} != ${member.memberCode}" 
				class="heartBtn" type="submit" id="heartBtnWhite"> 찜하기</button>
			</th:block>
			
			<th:block th:if="${cnt123 >= 1}">
				<button th:if="${post.pMemCode} != ${member.memberCode}" 
				class="heartBtn" type="submit" id="heartBtnRed"> 찜하기</button>
			</th:block>


		
	</div>
	<!-- JavaScript Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
		crossorigin="anonymous"></script>
		
<script>
	$("#postCode").css("display", "none");
	$("#pMemCode").css("display", "none");
	$("#heartBtnRed").css('backgroundColor', 'red');
	document.getElementById('notifyBtn').addEventListener('click', (e)=>{ 
		$.ajax({
		      type : "POST",
		      url : "/notify/post",
		      data : {
		         "postCode" : $("#postCode").text(),
		         "pMemCode" : $("#pMemCode").text()
		      },
		      success : function(cnt){
		    	  console.log(cnt);
		    	  if(cnt==0){	//cnt가 0일때. 사용자가 신고하지 않은 게시글
		    		  console.log(cnt);
			    		  if(confirm("신고하시겠습니까?")){
			    			  alert("신고되었습니다.");
			    			  location.href="http://localhost:8080";
		    		  }
		    	  }
		    	  else if(cnt>=1){	//cnt가 1 이상일때, 사용자가 1번 이상 신고한 게시글
	    			  console.log(cnt);
	    			  alert("이미 신고한 게시글입니다.");
	    		  }
		      }
		      });
		});
	
	var heartBtn = document.querySelectorAll('.heartBtn');
	
	for(let i =0; i<2; i++){
		heartBtn[i].addEventListener('click', (e)=>{
			$.ajax({
			      type : "POST",
			      url : "/heart",
			      data : {
			         "postCode" : $("#postCode").text()
			      }, 
			      success:function(cnt){
			    	  console.log(cnt);
			    	  if(cnt=>1){
			    		  $("#heartBtnWhite").css('backgroundColor', 'red');
			    		  $("#heartBtnRed").css('backgroundColor', 'red');
			      	}if(cnt==0){
			      		 $("#heartBtnWhite").css('backgroundColor', '#F0F0F0');
			      		 $("#heartBtnRed").css('backgroundColor', '#F0F0F0');
			      		 
			      	}
			 }
			      });
		});

	}
	

	
	
</script>
</body>
</html>